<div class="lincx-sticky-offer-bar">
  {{#ads}}
  <div id="{{ adId }}" class="lincx-sticky-offer-wrapper">
    <button class="lincx-sticky-offer-bar-close" aria-label="Close offer bar">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4L4 12M4 4l8 8" stroke="#666" stroke-width="2" stroke-linecap="round"></path>
      </svg>
    </button>
    <div class="lincx-container">
      <div class="lincx-row">
        <div class="lincx-image-col">
          <img src="{{image}}" alt="{{offer_headline}}" />
        </div>
        <div class="lincx-promo-col">
          <strong class="lincx-promo-text">{{{promo}}}</strong>
        </div>
        <div class="lincx-cta-col">
          <div class="lincx-cta-wrapper">
            <div class="lincx-rating-box">
              <div class="lincx-rating-number" data-rating-score="{{rating_score}}">{{rating_score}}</div>
              <div class="lincx-rating-text">
                <span class="lincx-rating-label" data-rating-score="{{rating_score}}">EXCELLENT</span>
                <div class="lincx-rating-stars" data-rating-stars="{{rating_stars}}"></div>
              </div>
            </div>
            <a
              href="{{href}}"
              target="_blank"
              data-lincx-cta
              data-lincx-cta-name="cta"
              data-lincx-cta-position="cta"
              class="lincx-offer-bar-btn"
            >
              {{{cta_text}}}
              <svg
                class="lincx-btn-arrow"
                width="16"
                height="14"
                viewBox="0 0 16 14"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M1.00001 6.00127H12.86L9.22997 1.64125C9.06025 1.43703 8.97857 1.17375 9.00295 0.909325C9.02732 0.644897 9.1558 0.40099 9.36002 0.23125C9.56425 0.06151 9.8275 -0.0201501 10.0919 0.00423243C10.3563 0.0286074 10.6003 0.15703 10.77 0.361247L15.77 6.36127C15.8036 6.40897 15.8337 6.45914 15.86 6.51127C15.86 6.56122 15.86 6.59122 15.93 6.64124C15.9753 6.75592 15.999 6.87794 16 7.00124C15.999 7.12454 15.9753 7.24657 15.93 7.36125C15.93 7.41127 15.93 7.44127 15.86 7.49122C15.8337 7.54342 15.8036 7.59352 15.77 7.64122L10.77 13.6412C10.676 13.7542 10.5582 13.8449 10.4252 13.9072C10.292 13.9693 10.1469 14.0015 10 14.0012C9.76637 14.0017 9.53995 13.9204 9.36002 13.7713C9.25877 13.6873 9.17507 13.5842 9.11372 13.4678C9.05237 13.3515 9.01457 13.2242 9.0025 13.0932C8.99042 12.9622 9.0043 12.8302 9.0433 12.7045C9.08237 12.579 9.14582 12.4623 9.22997 12.3613L12.86 8.00122H1.00001C0.734783 8.00122 0.480428 7.89592 0.292898 7.70834C0.10536 7.52084 0 7.26644 0 7.00124C0 6.73604 0.10536 6.48164 0.292898 6.29414C0.480428 6.10664 0.734783 6.00127 1.00001 6.00127Z"
                  fill="white"
                ></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {{/ads}}
  <script>
    function initializeOffers() {
      const offers = document.querySelectorAll('.lincx-sticky-offer-wrapper')
      offers.forEach((offer, index) => {
        // Update rating label based on rating score
        const ratingLabel = offer.querySelector('.lincx-rating-label')
        if (ratingLabel) {
          const ratingScore = parseFloat(ratingLabel.getAttribute('data-rating-score')) || 0
          if (ratingScore >= 9.0) {
            ratingLabel.textContent = 'EXCELLENT'
          } else if (ratingScore >= 7.0) {
            ratingLabel.textContent = 'GOOD'
          } else {
            ratingLabel.textContent = 'AVERAGE'
          }
        }

        // Update star rating based on rating stars
        const ratingStars = offer.querySelector('.lincx-rating-stars')
        if (ratingStars) {
          const ratingStarsValue = parseFloat(ratingStars.getAttribute('data-rating-stars')) || 0
          let rating = ratingStarsValue
          if (rating < 0) {
            rating = 0
          }
          rating = Math.min(rating, 5)

          const fullStars = Math.floor(rating)
          const hasHalfStar = rating % 1 >= 0.5
          const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0)

          let starsHTML = ''
          for (let i = 0; i < fullStars; i++) {
            starsHTML += '<span class="star full">★</span>'
          }
          if (hasHalfStar) {
            starsHTML += '<span class="star half">★</span>'
          }
          for (let i = 0; i < emptyStars; i++) {
            starsHTML += '<span class="star empty">★</span>'
          }
          ratingStars.innerHTML = starsHTML
        }
      })
    }

    initializeOffers()
  </script>
</div>
